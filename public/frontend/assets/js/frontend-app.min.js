/*! Frontend App - Production Optimized */
(function($){'use strict';const $doc=$(document),$win=$(window),$html=$('html'),$body=$('body'),$themeToggle=$('#themeToggle'),$headerMenuTrigger=$('#headerMenuTrigger'),$headerMenuDropdown=$('#headerMenuDropdown');(function(){function setHeaderThemeSwitch(theme){const $switch=$('.header-menu-switch');if(!$switch.length)return;$switch.toggleClass('header-menu-switch--on',theme==='dark')}function applyTheme(theme){const isLight=theme==='light';$html.toggleClass('light-mode',isLight);$body.toggleClass('light-theme',isLight).toggleClass('dark-theme',!isLight);$themeToggle.html(`<i class="fas fa-${isLight?'sun':'moon'}"></i>`);$('#themeToggleMobile').html(`<i class="fas fa-${isLight?'moon':'sun'}"></i>`);setHeaderThemeSwitch(theme);localStorage.setItem('theme',theme)}function initTheme(){applyTheme(localStorage.getItem('theme')||'dark')}function toggleTheme(){applyTheme($html.hasClass('light-mode')?'dark':'light')}initTheme();$themeToggle.on('click',e=>{e.preventDefault();toggleTheme()});$doc.on('click','.header-menu-toggle',e=>{e.preventDefault();e.stopPropagation();$themeToggle.trigger('click')});$('#themeToggleMobile').on('click',toggleTheme)})();(function(){if($headerMenuTrigger.length&&$headerMenuDropdown.length){const closeHeaderMenu=()=>$headerMenuDropdown.removeClass('active');$headerMenuTrigger.on('click',e=>{e.preventDefault();e.stopPropagation();$headerMenuDropdown.toggleClass('active')});$doc.on('click',closeHeaderMenu);$headerMenuDropdown.on('click',e=>e.stopPropagation());$doc.on('keydown',e=>{if(e.key==='Escape')closeHeaderMenu()})}})();(function(){const adjustDropdownPosition=$dropdown=>{if(!$dropdown.length)return;$dropdown.css({left:'auto',right:'auto'});setTimeout(()=>{const offset=$dropdown.offset();if(offset&&offset.left+$dropdown.outerWidth()>$win.width()-20){$dropdown.css({left:'auto',right:'0'})}},10)};$doc.on('click','#filterToggleBtn',function(){$(this).toggleClass('active');$('.filter-options-row').toggleClass('active')});$doc.on('click','.filter-btn',function(){$('.filter-btn').removeClass('active');$(this).addClass('active')});$doc.on('click','.sort-by-btn, .frequency-btn, .status-btn',function(e){e.stopPropagation();const $wrapper=$(this).closest('.filter-dropdown-wrapper');$('.filter-dropdown-wrapper').not($wrapper).removeClass('active');$wrapper.toggleClass('active');if($wrapper.hasClass('active')){adjustDropdownPosition($wrapper.find('.sort-dropdown-menu, .frequency-dropdown-menu, .status-dropdown-menu'))}});$doc.on('click','.sort-option, .frequency-option, .status-option',function(e){e.stopPropagation();const $this=$(this);const isSort=$this.hasClass('sort-option');const isFreq=$this.hasClass('frequency-option');const text=isSort?$this.find('span').first().text():$this.text();$this.siblings().removeClass('active');$this.addClass('active');if(isSort)$('.sort-by-btn .filter-option-text').text(text);if(isFreq)$('.frequency-btn .filter-option-text').text(text);if(!$this.hasClass('status-option'))$this.closest('.filter-dropdown-wrapper').removeClass('active')});$doc.on('click',e=>{if(!$(e.target).closest('.filter-dropdown-wrapper').length){$('.filter-dropdown-wrapper').removeClass('active')}});$win.on('resize',()=>{$('.filter-dropdown-wrapper.active').each(function(){adjustDropdownPosition($(this).find('.sort-dropdown-menu, .frequency-dropdown-menu, .status-dropdown-menu'))})});const $filtersSection=$('#filtersSection');if($filtersSection.length){const updateScrollButtons=()=>{const scrollLeft=$filtersSection.scrollLeft();const maxScroll=$filtersSection[0].scrollWidth-$filtersSection[0].clientWidth;$('#filterScrollLeft').toggleClass('disabled',scrollLeft<=0);$('#filterScrollRight').toggleClass('disabled',scrollLeft>=maxScroll-1)};$('#filterScrollLeft, #filterScrollRight').on('click',function(){const dir=$(this).attr('id')==='filterScrollLeft'?-1:1;$filtersSection.animate({scrollLeft:$filtersSection.scrollLeft()+(dir*200)},300,updateScrollButtons)});$filtersSection.on('scroll',updateScrollButtons);$win.on('resize',()=>setTimeout(updateScrollButtons,100));updateScrollButtons()}})();(function(){const $navContent=$('.nav-content'),$navItemsWrapper=$('.nav-items-wrapper'),$moreDropdown=$('#moreNavDropdown'),$moreDropdownMenu=$('#moreDropdownMenu'),$moreBtn=$('#moreNavBtn');function handleNavOverflow(){if($win.width()<992){$moreDropdown.hide();$navItemsWrapper.find('.nav-item').each(function(){const $item=$(this);if($item.data('moved-to-dropdown')){$item.data('moved-to-dropdown',false)}});return}$moreDropdown.show();const $moreDropdownInWrapper=$navItemsWrapper.find('#moreNavDropdown');$moreDropdownMenu.find('.dropdown-item').each(function(){const $item=$(this);const originalItem=$item.data('original-item');if(originalItem){$item.remove();if($moreDropdownInWrapper.length){originalItem.show().insertBefore($moreDropdownInWrapper)}else{originalItem.show().appendTo($navItemsWrapper)}originalItem.removeData('moved-to-dropdown')}});$moreDropdownMenu.find('.nav-item').each(function(){const $item=$(this);if(!$item.closest('.nav-items-wrapper').length){if($moreDropdownInWrapper.length){$item.insertBefore($moreDropdownInWrapper)}else{$item.appendTo($navItemsWrapper)}$item.removeData('moved-to-dropdown')}});if(!$moreDropdown.closest('.nav-items-wrapper').length){$moreDropdown.appendTo($navItemsWrapper)}const $allNavItems=$navItemsWrapper.find('.nav-item').filter(function(){const href=$(this).attr('href')||'';const isMoreBtn=$(this).attr('id')==='moreNavBtn';return!href.includes('trending')&&!href.includes('new')&&!isMoreBtn});const totalItems=$allNavItems.length;const maxVisibleItems=12;if(totalItems>maxVisibleItems){let visibleCount=0;let movedCount=0;let $lastVisibleItem=null;$allNavItems.each(function(){const $item=$(this);if($item.data('moved-to-dropdown')){return}visibleCount++;if(visibleCount>maxVisibleItems){const $dropdownItem=$('<a>').addClass('dropdown-item').attr('href',$item.attr('href')).html($item.html()).data('original-item',$item);if($item.hasClass('active')){$dropdownItem.addClass('active')}$dropdownItem.on('click',function(e){const href=$(this).attr('href');if(href&&href!=='#'&&href!=='index.html'){$('.nav-item, .dropdown-item').removeClass('active');$(this).addClass('active');$moreDropdownMenu.removeClass('active');$moreDropdown.removeClass('active')}});$moreDropdownMenu.append($dropdownItem);$item.hide().data('moved-to-dropdown',true);movedCount++}else{$lastVisibleItem=$item}});if(movedCount>0&&$lastVisibleItem&&$lastVisibleItem.length){$moreDropdown.insertAfter($lastVisibleItem);$moreBtn.show()}else{$moreBtn.hide()}}else{$moreBtn.hide()}}function adjustDropdownPosition(){if(!$moreDropdownMenu.hasClass('active'))return;const $dropdown=$moreDropdownMenu;const dropdownWidth=$dropdown.outerWidth();const dropdownLeft=$moreDropdown.offset().left;const windowWidth=$win.width();$dropdown.css({left:'0',right:'auto'});if(dropdownLeft+dropdownWidth>windowWidth-20){const rightPosition=windowWidth-dropdownLeft-$moreDropdown.outerWidth();$dropdown.css({left:'auto',right:rightPosition+'px'})}}$doc.on('click','.nav-item',function(e){const $this=$(this);const href=$this.attr('href');const isMoreBtn=$this.attr('id')==='moreNavBtn';const isProfileBtn=$this.attr('id')==='profileNavBtn';if(isMoreBtn||isProfileBtn){e.preventDefault();if(isMoreBtn){$moreDropdownMenu.toggleClass('active');$moreDropdown.toggleClass('active');$('#profileNavDropdownMenu').removeClass('active');if($moreDropdownMenu.hasClass('active')){setTimeout(adjustDropdownPosition,10)}}else{$('#profileNavDropdownMenu').toggleClass('active');$moreDropdownMenu.removeClass('active');$moreDropdown.removeClass('active')}return}if(!href||href===''||href==='#')e.preventDefault();if(!$this.closest('.more-dropdown-menu, .profile-nav-dropdown-menu').length){$('.nav-item, .dropdown-item').removeClass('active');$this.addClass('active');$moreDropdownMenu.removeClass('active')}});$doc.on('click',e=>{if(!$(e.target).closest('.nav-item-dropdown').length){$moreDropdownMenu.removeClass('active');$moreDropdown.removeClass('active')}});$win.on('resize',()=>{setTimeout(()=>{handleNavOverflow();adjustDropdownPosition()},100)});setTimeout(handleNavOverflow,100)})();(function(){const checkScreenSize=()=>{const isMobile=$win.width()<=768;$body.toggleClass('mobile',isMobile);$('.mobile-bottom-nav').toggleClass('active',isMobile)};$doc.on('click','.mobile-nav-item',function(e){const text=$(this).find('span').text().trim();if(text==='Search'){e.preventDefault();const isOpen=$('#mobileSearchPopup').hasClass('active');if(isOpen){$('#mobileSearchPopup, #mobileSearchOverlay').removeClass('active');$body.css('overflow','');$('.mobile-nav-item').removeClass('active');$('.mobile-nav-item:has(span:contains("Home"))').addClass('active')}else{$('.mobile-nav-item').removeClass('active');$(this).addClass('active');$('#moreMenuSidebar, #moreMenuOverlay').removeClass('active');$('#mobileSearchPopup, #mobileSearchOverlay').addClass('active');$body.css('overflow','hidden');setTimeout(()=>$('#mobileSearchInput').focus(),300)}}else if(text==='More'){e.preventDefault();$('.mobile-nav-item').removeClass('active');$(this).addClass('active');$('#mobileSearchPopup, #mobileSearchOverlay').removeClass('active');$('#moreMenuSidebar, #moreMenuOverlay').addClass('active');$body.css('overflow','hidden')}});$doc.on('click','#moreMenuBtn, #closeMenuBtn, #moreMenuOverlay',function(e){if($(this).attr('id')==='moreMenuBtn'){e.preventDefault();$('#mobileSearchPopup, #mobileSearchOverlay').removeClass('active');$('.mobile-nav-item').removeClass('active');$('#moreMenuSidebar, #moreMenuOverlay').addClass('active');$body.css('overflow','hidden')}else{$('#moreMenuSidebar, #moreMenuOverlay').removeClass('active');$body.css('overflow','')}});$doc.on('click','#mobileSearchClose, #mobileSearchOverlay',function(e){e.preventDefault();$('#mobileSearchPopup, #mobileSearchOverlay').removeClass('active');$body.css('overflow','');$('.mobile-nav-item').removeClass('active');$('.mobile-nav-item:has(span:contains("Home"))').addClass('active')});$win.on('resize',checkScreenSize);checkScreenSize()})();(function(){$doc.on('keydown',function(e){const $search=$('#marketSearchInput, input[wire\\:model\\.live\\.debounce\\.300ms="search"]');if((e.ctrlKey||e.metaKey)&&e.key==='k'){e.preventDefault();$('#marketSearchInput').focus()}if(e.key==='Escape'&&$search.is(':focus')){$('#marketSearchInput').val('');const $livewireSearch=$('input[wire\\:model\\.live\\.debounce\\.300ms="search"]');if($livewireSearch.length){$livewireSearch.val('').trigger('input')}}})})();window.showNotification=function(message,type='info'){const colors={success:{bg:'#00C853',color:'#fff'},danger:{bg:'#FF4757',color:'#fff'},info:{bg:'#ffb11a',color:'#000'}};const style=colors[type]||colors.info;const $notif=$('<div>').text(message).css({position:'fixed',top:'100px',right:'20px',padding:'12px 20px',background:style.bg,color:style.color,borderRadius:'6px',fontWeight:'600',zIndex:'1000',boxShadow:'0 4px 12px rgba(0,0,0,0.2)',animation:'slideIn 0.3s ease'});$body.append($notif);setTimeout(()=>{$notif.css('animation','slideOut 0.3s ease');setTimeout(()=>$notif.remove(),300)},2000)};(function(){$doc.on('click','.yes-btn, .no-btn',function(e){e.stopPropagation();const $btn=$(this);$btn.css('transform','scale(0.95)');setTimeout(()=>$btn.css('transform','scale(1.05)'),100);showNotification(`Vote recorded: ${$btn.hasClass('yes-btn')?'YES':'NO'}`,$btn.hasClass('yes-btn')?'success':'danger')});$doc.on('click','.action-btn',function(e){e.stopPropagation();const $icon=$(this).find('i');if($icon.hasClass('fa-bookmark')){const $btn=$(this);const isActive=$btn.css('opacity')!=='0.5';$btn.css({opacity:isActive?'0.5':'1',color:isActive?'':'var(--accent)'});showNotification(isActive?'Bookmark removed':'Market bookmarked',isActive?'danger':'success')}})})();(function(){if(!$('#marketChart').length&&!$('.outcome-row').length)return;$('#tradingPanel').removeClass('active');$('#mobilePanelOverlay').removeClass('active');$body.css('overflow','');let currentShares=0,isBuy=true,isYes=true,isLimitOrder=false,limitPrice=0,userBalance=window.userBalance||0;const updateSummary=()=>{let marketPrice;if(isLimitOrder&&limitPrice>0){marketPrice=limitPrice/100}else{if(window.currentYesPrice!==undefined&&window.currentNoPrice!==undefined){marketPrice=isYes?window.currentYesPrice/100:window.currentNoPrice/100}else{marketPrice=0.5}}marketPrice=Math.max(0.0001,Math.min(0.9999,marketPrice));const investment=parseFloat(currentShares)||0;const shares=marketPrice>0?investment/marketPrice:0;const payout=shares*1;$('#potentialPayout').text(`$${payout.toFixed(2)}`);const cost=shares*marketPrice;const portfolioBefore=userBalance||0;if(cost>portfolioBefore){$('#executeTrade').prop('disabled',true).addClass('disabled')}else{$('#executeTrade').prop('disabled',false).removeClass('disabled')}};const updateShares=amount=>{currentShares=Math.max(0,currentShares+amount);$('#sharesInput').val(currentShares);updateSummary()};updateSummary();const updateOutcomePrice=()=>{if(window.currentYesPrice!==undefined&&window.currentNoPrice!==undefined){const price=isYes?window.currentYesPrice:window.currentNoPrice;$('#limitPrice').val(price);limitPrice=price}};let currentMarketId=null;const populateTradingPanel=($row,isYesSelected,isMobile)=>{$('.outcome-row').removeClass('active selected');$row.addClass('active selected');let outcomeName=$row.find('.outcome-name').text().trim();if(!outcomeName){outcomeName=$row.find('.outcome-text .outcome-name').text().trim()}if(!outcomeName){outcomeName=$row.data('outcome-name')||''}let marketTitle=$('.market-title').text().trim()||$('#panelMarketTitle').text().trim();const $yesBtn=$row.find('.btn-yes');const $noBtn=$row.find('.btn-no');const yesPrice=parseFloat($yesBtn.text().match(/([\d.]+)¢/)?.[1]||0);const noPrice=parseFloat($noBtn.text().match(/([\d.]+)¢/)?.[1]||0);currentMarketId=$row.data('market-id')||$('#tradingPanel').data('market-id');if(marketTitle){$('#panelMarketTitle').text(marketTitle)}if(outcomeName){$('#panelOutcomeName').text(outcomeName);if($('#panelOutcomeTitle').length){$('#panelOutcomeTitle').text(outcomeName)}}if(isMobile){$('#buyTab').addClass('active');$('#sellTab').removeClass('active');$('#actionTabs').addClass('buy-only')}$('#yesBtn').html(`Yes ${yesPrice.toFixed(1)}¢`).attr('data-price',yesPrice);$('#noBtn').html(`No ${noPrice.toFixed(1)}¢`).attr('data-price',noPrice);if(isYesSelected){$('#yesBtn').addClass('active');$('#noBtn').removeClass('active');$('#limitPrice').val(yesPrice);$('#avgPriceValue').text(yesPrice.toFixed(0)+'¢');isYes=true;$('#executeTrade').text('Buy Yes')}else{$('#noBtn').addClass('active');$('#yesBtn').removeClass('active');$('#limitPrice').val(noPrice);$('#avgPriceValue').text(noPrice.toFixed(0)+'¢');isYes=false;$('#executeTrade').text('Buy No')}window.currentYesPrice=parseFloat(yesPrice)||0;window.currentNoPrice=parseFloat(noPrice)||0;limitPrice=isYesSelected?(parseFloat(yesPrice)||0):(parseFloat(noPrice)||0);updateSummary()};$doc.on('click','.tab-item',function(){$('.tab-item').removeClass('active');$(this).addClass('active');$('.tab-content').removeClass('active');$(`#${$(this).data('tab')}`).addClass('active')});$doc.on('click','.holders-tab',function(){$('.holders-tab').removeClass('active');$(this).addClass('active');$('#yes-holders, #no-holders').hide();$(`#${$(this).data('holders')}-holders`).show()});$doc.on('click','.activity-filter',function(){$('.activity-filter').removeClass('active');$(this).addClass('active')});$('#buyTab').on('click',()=>{$('.action-tab').removeClass('active');$('#buyTab').addClass('active');isBuy=true;updateOutcomePrice();updateSummary()});$('#sellTab').on('click',()=>{$('.action-tab').removeClass('active');$('#sellTab').addClass('active');isBuy=false;updateOutcomePrice();updateSummary()});$('#orderType').on('change',function(){isLimitOrder=$(this).val()==='limit';$('#limitOrderFields').toggleClass('active',isLimitOrder);updateSummary()});$('#limitPrice').on('input',function(){limitPrice=parseFloat($(this).val())||0;updateSummary()});$('#yesBtn').on('click',function(){$('.outcome-btn-yes, .outcome-btn-no').removeClass('active');$(this).addClass('active');isYes=true;$('#executeTrade').text('Buy Yes');if(window.currentYesPrice!==undefined)$('#limitPrice').val(window.currentYesPrice);updateOutcomePrice();updateSummary()});$('#noBtn').on('click',function(){$('.outcome-btn-yes, .outcome-btn-no').removeClass('active');$(this).addClass('active');isYes=false;$('#executeTrade').text('Buy No');if(window.currentNoPrice!==undefined)$('#limitPrice').val(window.currentNoPrice);updateOutcomePrice();updateSummary()});$('#decrease-100, #decrease-10, #increase-10, #increase-100').on('click',function(){updateShares(parseInt($(this).data('amount')||$(this).attr('id').includes('decrease')?-parseInt($(this).attr('id').match(/\d+/)[0]):parseInt($(this).attr('id').match(/\d+/)[0])))});$('#sharesInput').on('input',function(){const value=parseFloat($(this).val())||0;currentShares=Math.max(0,value);$(this).val(currentShares);updateSummary()});$doc.on('click','.quick-btn',function(){if(this.id==='maxShares'){currentShares=Math.floor(userBalance/0.01)}else{const percent=parseInt($(this).data('percent'));currentShares=Math.floor((userBalance*percent)/100/0.01)}$('#sharesInput').val(currentShares);updateSummary()});$doc.on('click','.shares-price',function(){updateShares(parseInt($(this).data('price')))});$('#executeTrade').on('click',function(){if(currentShares<=0){showWarning('Please enter a valid amount','Invalid Amount');return}if(!currentMarketId){showWarning('Market not selected','Selection Required');return}@auth let marketPrice=null;if(isLimitOrder&&limitPrice>0){marketPrice=limitPrice/100}else{if(isYes&&window.currentYesPrice!==undefined){marketPrice=window.currentYesPrice/100}else if(!isYes&&window.currentNoPrice!==undefined){marketPrice=window.currentNoPrice/100}else{marketPrice=0.5}}marketPrice=Math.max(0.0001,Math.min(0.9999,marketPrice));const investment=parseFloat(currentShares)||0;const shares=marketPrice>0?investment/marketPrice:0;const requiredAmount=shares*marketPrice;if(userBalance<requiredAmount){const shortfall=requiredAmount-userBalance;Swal.fire({icon:'warning',title:'Insufficient Balance',html:`You need $${requiredAmount.toFixed(2)} to place this trade.<br>Your current balance is $${userBalance.toFixed(2)}.<br><br>You need to deposit $${shortfall.toFixed(2)} more.`,showCancelButton:true,confirmButtonText:'Deposit Now',cancelButtonText:'Cancel',confirmButtonColor:getThemeColor('--accent'),cancelButtonColor:getThemeColor('--secondary'),background:getThemeColor('--card-bg'),color:getThemeColor('--text-primary'),customClass:{popup:'swal2-theme',title:'swal2-title-theme',content:'swal2-content-theme'},didClose:()=>{cleanupSwal()}}).then(result=>{if(result.isConfirmed){if(typeof window.openDepositModal==='function'){window.openDepositModal()}else{$('#depositBtn').trigger('click')}}});return}executeTrade()@else Swal.fire({icon:'warning',title:'Login Required',text:'Please login to place a trade',showCancelButton:true,confirmButtonText:'Go to Login',confirmButtonColor:getThemeColor('--accent'),cancelButtonColor:getThemeColor('--secondary'),cancelButtonText:'Cancel',background:getThemeColor('--card-bg'),color:getThemeColor('--text-primary'),customClass:{popup:'swal2-theme',title:'swal2-title-theme',content:'swal2-content-theme'},didClose:()=>{cleanupSwal()}}).then(result=>{if(result.isConfirmed){window.location.href='{{route('login')}}'}})@endauth});function executeTrade(){const $btn=$('#executeTrade');const originalText=$btn.text();$btn.prop('disabled',true).text('Processing...');let price=null;if(isLimitOrder&&limitPrice>0){price=limitPrice/100}else{if(isYes&&window.currentYesPrice!==undefined){price=window.currentYesPrice/100}else if(!isYes&&window.currentNoPrice!==undefined){price=window.currentNoPrice/100}else{price=0.5}}price=Math.max(0.0001,Math.min(0.9999,price));const tradeData={option:isYes?'yes':'no',amount:currentShares,price:price};fetch(`/trades/market/${currentMarketId}`,{method:'POST',headers:{'Content-Type':'application/json','X-CSRF-TOKEN':document.querySelector('meta[name="csrf-token"]')?.getAttribute('content')||'','Accept':'application/json'},body:JSON.stringify(tradeData)}).then(response=>response.json()).then(data=>{if(data.success){showSuccess('Trade placed successfully!','Trade Executed');currentShares=0;$('#sharesInput').val(0);updateSummary();if(window.innerWidth<=768){closeTradingPanel()}setTimeout(()=>{location.reload()},1500)}else{showError(data.message||'Failed to place trade','Trade Failed')}}).catch(error=>{showError('An error occurred. Please try again.','Error')}).finally(()=>{$btn.prop('disabled',false).text(originalText)})}$doc.on('click','.btn-yes, .btn-no',function(e){e.stopPropagation();const $row=$(this).closest('.outcome-row');const isMobile=$win.width()<=768;populateTradingPanel($row,$(this).hasClass('btn-yes'),isMobile);if(isMobile){$('#tradingPanel, #mobilePanelOverlay').addClass('active');$body.css('overflow','hidden');setTimeout(()=>$('#tradingPanel').scrollTop(0),100)}else{const $panel=$('#tradingPanel');if($panel.length)$('html, body').animate({scrollTop:$panel.offset().top-100},500)}});$doc.on('click','.outcome-row',function(e){if($(e.target).closest('.btn-yes, .btn-no').length)return;const $row=$(this);const isMobile=$win.width()<=768;populateTradingPanel($row,true,isMobile);if(isMobile){$('#tradingPanel, #mobilePanelOverlay').addClass('active');$body.css('overflow','hidden')}else{const $panel=$('#tradingPanel');if($panel.length)$('html, body').animate({scrollTop:$panel.offset().top-100},500)}});function closeTradingPanel(){$('#tradingPanel, #mobilePanelOverlay').removeClass('active');$body.css('overflow','')}$doc.on('click','#panelCloseBtn, #mobilePanelOverlay',function(e){e.preventDefault();e.stopPropagation();closeTradingPanel()});$doc.on('click','.show-more-btn',function(){$(this).toggleClass('expanded')});$doc.on('click','.reply-btn',function(){$(this).closest('.comment-section').find('.comment-reply-wrapper').slideToggle(200)});$doc.on('click','.comment-reply-cancel-btn',function(){$(this).closest('.comment-reply-wrapper').slideUp(200).find('.comment-reply-input').val('')});$doc.on('click','.comment-reply-submit-btn',function(){const replyText=$(this).siblings('.comment-reply-input').val().trim();if(replyText===''){showWarning('Please enter a reply','Reply Required');return}showSuccess('Reply posted: '+replyText,'Reply Posted');$(this).siblings('.comment-reply-input').val('');$(this).closest('.comment-reply-wrapper').slideUp(200)});$doc.on('keypress','.comment-reply-input',function(e){if(e.which===13)$(this).siblings('.comment-reply-submit-btn').click()});$doc.on('click','.chart-btn',function(){$('.chart-btn').removeClass('active');$(this).addClass('active');if(window.marketChart){window.marketChart.data.datasets[0].data=generateChartData(50,100);window.marketChart.data.datasets[1].data=generateChartData(48,100);window.marketChart.data.datasets[2].data=generateChartData(1.9,100);window.marketChart.data.datasets[3].data=generateChartData(0.5,100);window.marketChart.update()}});const generateChartData=(target,length)=>{const data=[];let current=Math.random()*20+10;for(let i=0;i<length;i++){current=current+(Math.random()-0.5)*10+(target-current)*0.02;data.push(Math.max(0,Math.min(100,current)))}return data};const initMarketChart=()=>{const ctx=$('#marketChart')[0];if(ctx&&typeof Chart!=='undefined'){window.marketChart=new Chart(ctx.getContext('2d'),{type:'line',data:{labels:Array.from({length:100},(_,i)=>i),datasets:[{label:'No change',data:generateChartData(50,100),borderColor:'#f97316',borderWidth:2,tension:0.1,pointRadius:0},{label:'25 bps decrease',data:generateChartData(48,100),borderColor:'#3b82f6',borderWidth:2,tension:0.1,pointRadius:0},{label:'50+ bps decrease',data:generateChartData(1.9,100),borderColor:'#06b6d4',borderWidth:2,tension:0.1,pointRadius:0},{label:'25+ bps increase',data:generateChartData(0.5,100),borderColor:'#eab308',borderWidth:2,tension:0.1,pointRadius:0}]},options:{responsive:true,maintainAspectRatio:false,plugins:{legend:{display:false},tooltip:{mode:'index',intersect:false}},scales:{y:{grid:{color:'#374151'},position:'right',ticks:{callback:v=>v+'%'}}},interaction:{mode:'nearest',axis:'x',intersect:false}}})}};const checkChartJS=()=>{if(typeof Chart!=='undefined')initMarketChart();else setTimeout(checkChartJS,50)};checkChartJS();updateOutcomePrice();updateSummary()})();(function(){const handleHashNavigation=()=>{const hash=window.location.hash.replace('#','');const validHashes=['profile','account','trading','notifications','builder','export'];if(hash&&validHashes.includes(hash)){$('.settings-tab, .mobile-profile-dropdown-item, .profile-nav-dropdown-menu .dropdown-item').removeClass('active');$(`.settings-tab[data-tab="${hash}"], .mobile-profile-dropdown-item[data-tab="${hash}"], .profile-nav-dropdown-menu .dropdown-item[href*="${hash}"]`).addClass('active');$('.tab-content').removeClass('active');$(`#${hash}-tab`).addClass('active');setTimeout(()=>$('html, body').animate({scrollTop:$('.settings-container').offset().top-20},300),100)}};$doc.on('click','.content-tab',function(){const tab=$(this).data('tab');$('.content-tab').removeClass('active');$(this).addClass('active');$('.tab-content-wrapper').addClass('d-none');$(`#${tab}-tab`).removeClass('d-none')});$doc.on('click','.subtab-btn',function(){const subtab=$(this).data('subtab');$('.subtab-btn').removeClass('active');$(this).addClass('active');$('.active-headers').toggleClass('d-none',subtab!=='active');$('.closed-headers').toggleClass('d-none',subtab==='active');$('#sortFilterBtn span').text(subtab==='active'?'Value':'Profit/Loss')});$doc.on('click','.time-filter-btn',function(){$('.time-filter-btn').removeClass('active');$(this).addClass('active');const time=$(this).data('time');const timeframes={'ALL':'All-Time','1D':'Past Day','1W':'Past Week','1M':'Past Month'};$('#profitLossTimeframe').text(timeframes[time]||'All-Time')});$doc.on('click','#sortFilterBtn, #amountFilterBtn',function(e){e.stopPropagation();const $wrapper=$(this).closest('.filter-dropdown-wrapper');$('.filter-dropdown-wrapper').not($wrapper).removeClass('active');$wrapper.toggleClass('active')});$doc.on('click','#sortFilterMenu .filter-dropdown-item, #amountFilterMenu .filter-dropdown-item',function(e){e.preventDefault();const $this=$(this);const text=$this.text();$this.siblings().removeClass('active');$this.addClass('active');$this.closest('.filter-dropdown-wrapper').find('span').text(text);$this.closest('.filter-dropdown-wrapper').removeClass('active')});$doc.on('input','.search-input',function(){const term=$(this).val().toLowerCase().trim();$('.positions-table tbody tr').each(function(){$(this).toggle($(this).text().toLowerCase().includes(term))})});$doc.on('click','.settings-tab',function(e){e.preventDefault();$('.settings-tab').removeClass('active');$(this).addClass('active');$('.tab-content').removeClass('active');const tabId=$(this).data('tab');$(`#${tabId}-tab`).addClass('active');$('.mobile-profile-dropdown-item').removeClass('active');$(`.mobile-profile-dropdown-item[data-tab="${tabId}"]`).addClass('active')});$('#mobileProfileDropdownBtn').on('click',function(e){e.stopPropagation();$('.mobile-profile-dropdown').toggleClass('active')});$doc.on('click','.mobile-profile-dropdown-item',function(e){e.preventDefault();const tabId=$(this).data('tab');$('.mobile-profile-dropdown-item, .settings-tab').removeClass('active');$(this).addClass('active');$(`.settings-tab[data-tab="${tabId}"]`).addClass('active');$('.tab-content').removeClass('active');$(`#${tabId}-tab`).addClass('active');$('.mobile-profile-dropdown').removeClass('active');$('html, body').animate({scrollTop:$('.settings-container').offset().top-20},300)});$doc.on('click',e=>{if(!$(e.target).closest('.mobile-profile-dropdown').length){$('.mobile-profile-dropdown').removeClass('active')}});handleHashNavigation();$win.on('hashchange',handleHashNavigation)})();(function(){const observer=new IntersectionObserver(entries=>{entries.forEach(entry=>{if(entry.isIntersecting){$(entry.target).css('animation','fadeIn 0.5s ease')}})});$('.market-card').each(function(){observer.observe(this)})})()})(jQuery);

