$(function(){const e=$("#themeToggle"),t=$("html"),a=$("body");function o(e){const t=$(".header-menu-switch");t.length&&("dark"===e?t.addClass("header-menu-switch--on"):t.removeClass("header-menu-switch--on"))}function i(i){"light"===i?(t.addClass("light-mode"),a.addClass("light-theme").removeClass("dark-theme"),e.html('<i class="fas fa-sun"></i>'),o("light")):(t.removeClass("light-mode"),a.addClass("dark-theme").removeClass("light-theme"),e.html('<i class="fas fa-moon"></i>'),o("dark")),localStorage.setItem("theme",i)}function s(e,t="info"){const a="success"===t?"#00C853":"danger"===t?"#FF4757":"#ffb11a",o="success"===t||"danger"===t?"#fff":"#000",i=$("<div></div>").text(e).css({position:"fixed",top:"100px",right:"20px",padding:"12px 20px",background:a,color:o,borderRadius:"6px",fontWeight:"600",zIndex:"1000",boxShadow:"0 4px 12px rgba(0,0,0,0.2)",animation:"slideIn 0.3s ease"});$("body").append(i),setTimeout(()=>{i.css("animation","slideOut 0.3s ease"),setTimeout(()=>i.remove(),300)},2e3)}function n(){$(window).width()<=768?(a.addClass("mobile"),$(".mobile-bottom-nav").addClass("active")):(a.removeClass("mobile"),$(".mobile-bottom-nav").removeClass("active"))}function c(){const e=JSON.parse(localStorage.getItem("recentSearches")||"[]"),t=$(".recent-searches-list");t.html(""),e.length>0?e.slice(0,5).forEach(function(e){t.append('<div class="recent-search-item" data-search="'+e+'"><span>'+e+'</span><i class="fas fa-times"></i></div>')}):t.append('<div style="color: var(--text-secondary); padding: 12px;">No recent searches</div>')}i(localStorage.getItem("theme")||"dark"),e.on("click",function(e){e.preventDefault(),t.hasClass("light-mode")?i("dark"):i("light")}),$(document).on("click",".header-menu-toggle",function(e){e.preventDefault(),e.stopPropagation(),$("#themeToggle").trigger("click")}),$(document).ready(function(){$("#filterToggleBtn").on("click",function(){$(this).toggleClass("active"),$(".filter-options-row").toggleClass("active")}),$(".filter-btn").on("click",function(){$(".filter-btn").removeClass("active"),$(this).addClass("active")});const e=$("#filtersSection"),t=$("#filterScrollLeft"),a=$("#filterScrollRight");if(e.length>0&&e[0]){function o(){if(!e.length||!e[0])return;const o=e.scrollLeft(),i=e[0].scrollWidth,s=e[0].clientWidth;o<=0?t.addClass("disabled"):t.removeClass("disabled"),o+s>=i-1?a.addClass("disabled"):a.removeClass("disabled")}t.on("click",function(){e.length>0&&e.animate({scrollLeft:e.scrollLeft()-200},{duration:300,complete:function(){o()}})}),a.on("click",function(){e.length>0&&e.animate({scrollLeft:e.scrollLeft()+200},{duration:300,complete:function(){o()}})}),e.on("scroll",o),$(window).on("resize",function(){setTimeout(o,100)}),o()}function i(e){e.length&&(e.css({left:"auto",right:"auto"}),setTimeout(function(){const t=e.outerWidth(),a=e.offset(),o=$(window).width();a.left+t>o-20?e.css({left:"auto",right:"0"}):e.css({left:"0",right:"auto"})},10))}$(".mobile-nav-item").on("click",function(e){e.preventDefault(),$(".mobile-nav-item").removeClass("active"),$(this).addClass("active")}),$(".sort-by-btn").on("click",function(e){e.stopPropagation();const t=$(this).closest(".sort-by-wrapper");$(".filter-dropdown-wrapper").not(t).removeClass("active"),t.toggleClass("active"),t.hasClass("active")&&i(t.find(".sort-dropdown-menu"))}),$(".frequency-btn").on("click",function(e){e.stopPropagation();const t=$(this).closest(".frequency-wrapper");$(".filter-dropdown-wrapper").not(t).removeClass("active"),t.toggleClass("active"),t.hasClass("active")&&i(t.find(".frequency-dropdown-menu"))}),$(".status-btn").on("click",function(e){e.stopPropagation();const t=$(this).closest(".status-wrapper");$(".filter-dropdown-wrapper").not(t).removeClass("active"),t.toggleClass("active"),t.hasClass("active")&&i(t.find(".status-dropdown-menu"))}),$(".sort-option").on("click",function(e){e.stopPropagation();const t=$(this).find("span").first().text();$(".sort-option").removeClass("active"),$(this).addClass("active"),$(".sort-by-btn .filter-option-text").text(t),$(".sort-by-wrapper").removeClass("active")}),$(".frequency-option").on("click",function(e){e.stopPropagation();const t=$(this).text();$(".frequency-option").removeClass("active"),$(this).addClass("active"),$(".frequency-btn .filter-option-text").text(t),$(".frequency-wrapper").removeClass("active")}),$(".status-option").on("click",function(e){e.stopPropagation();const t=$(this).text();$(".status-option").removeClass("active"),$(this).addClass("active"),$(".status-btn .filter-option-text").text(t),$(".status-wrapper").removeClass("active")}),$(document).on("click",function(e){$(e.target).closest(".filter-dropdown-wrapper").length||$(".filter-dropdown-wrapper").removeClass("active")}),$(window).on("resize",function(){$(".filter-dropdown-wrapper.active").each(function(){const e=$(this).find(".sort-dropdown-menu, .frequency-dropdown-menu, .status-dropdown-menu");e.length&&i(e)})})}),$(".yes-btn, .no-btn").on("click",function(e){e.stopPropagation();const t=$(this);t.css("transform","scale(0.95)"),setTimeout(()=>t.css("transform","scale(1.05)"),100);const a=t.hasClass("yes-btn");s(a?"Vote recorded: YES":"Vote recorded: NO",a?"success":"danger")}),$(".action-btn").on("click",function(e){e.stopPropagation();if($(this).find("i").hasClass("fa-bookmark")){const e=$(this);"0.5"===e.css("opacity")?(e.css({opacity:"1",color:"var(--accent)"}),s("Market bookmarked","success")):(e.css("opacity","0.5"),s("Bookmark removed","danger"))}}),$(".search-bar input").on("input",function(){const e=$(this).val().toLowerCase();$(".market-card").each(function(){$(this).find(".market-title").text().toLowerCase().includes(e)?$(this).css({display:"flex",animation:"fadeIn 0.3s ease"}):$(this).hide()})}),$(".nav-item").on("click",function(e){if($(this).closest(".nav-item-dropdown").length&&"moreNavBtn"===$(this).attr("id"))return e.preventDefault(),$("#moreDropdownMenu").toggleClass("active"),void $("#profileNavDropdownMenu").removeClass("active");if($(this).closest(".nav-item-dropdown").length&&"profileNavBtn"===$(this).attr("id"))return e.preventDefault(),$("#profileNavDropdownMenu").toggleClass("active"),void $("#moreDropdownMenu").removeClass("active");const t=$(this).attr("href"),a=t&&""!==t&&"#"!==t;$(this).closest(".more-dropdown-menu, .profile-nav-dropdown-menu").length||(a||e.preventDefault(),$(".nav-item").removeClass("active"),$(this).addClass("active"),$("#moreDropdownMenu").removeClass("active"),$("#profileNavDropdownMenu").removeClass("active"))}),$(".profile-nav-dropdown-menu .dropdown-item").on("click",function(e){const t=$(this).attr("href");t&&t.includes("user dashboard.html")&&($(".profile-nav-dropdown-menu .dropdown-item").removeClass("active"),$(this).addClass("active"),$("#profileNavDropdownMenu").removeClass("active"))}),$(document).on("click",function(e){$(e.target).closest(".nav-item-dropdown").length||($("#moreDropdownMenu").removeClass("active"),$("#profileNavDropdownMenu").removeClass("active"))}),$(document).on("keydown",function(e){const t=$(".search-bar input");(e.ctrlKey||e.metaKey)&&"k"===e.key&&(e.preventDefault(),t.focus()),"Escape"===e.key&&t.is(":focus")&&(t.val(""),$(".market-card").show())}),$(window).on("resize",n),n(),$("#mobileMenuToggle").on("click",function(){$("#moreMenuSidebar, #moreMenuOverlay").addClass("active"),$("body").css("overflow","hidden")}),$(".mobile-nav-item").on("click",function(e){e.preventDefault();const t=$(this).find("span").text();"Search"===t?($("#moreMenuSidebar").hasClass("active")&&$("#moreMenuSidebar, #moreMenuOverlay").removeClass("active"),$("#mobileSearchPopup, #mobileSearchOverlay").addClass("active"),$("body").css("overflow","hidden"),setTimeout(function(){$("#mobileSearchInput").focus()},300),$(".mobile-nav-item").removeClass("active"),$(this).addClass("active")):"Breaking"===t?($(".filter-btn").removeClass("active"),$(".nav-item").removeClass("active"),$('.nav-item:contains("Breaking")').addClass("active"),$(".mobile-nav-item").removeClass("active"),$(this).addClass("active")):"More"===t?($("#mobileSearchPopup").hasClass("active")&&($("#mobileSearchPopup, #mobileSearchOverlay").removeClass("active"),$("#mobileSearchInput").val(""),$("#mobileSearchResults").html(""),$("#mobileSearchProfiles").html("")),$("#moreMenuSidebar, #moreMenuOverlay").addClass("active"),$("body").css("overflow","hidden")):($(".mobile-nav-item").removeClass("active"),$(this).addClass("active"))}),$("#moreMenuBtn, #closeMenuBtn, #moreMenuOverlay").on("click",function(e){"moreMenuBtn"===$(this).attr("id")?(e.preventDefault(),$("#mobileSearchPopup").hasClass("active")&&($("#mobileSearchPopup, #mobileSearchOverlay").removeClass("active"),$("#mobileSearchInput").val(""),$("#mobileSearchResults").html(""),$("#mobileSearchProfiles").html(""),$(".mobile-nav-item").removeClass("active")),$("#moreMenuSidebar, #moreMenuOverlay").addClass("active"),$("body").css("overflow","hidden")):($("#moreMenuSidebar, #moreMenuOverlay").removeClass("active"),$("body").css("overflow",""))}),$("#mobileSearchClose, #mobileSearchOverlay").on("click",function(e){e.preventDefault(),$("#mobileSearchPopup, #mobileSearchOverlay").removeClass("active"),$("body").css("overflow",""),$("#mobileSearchInput").val(""),$("#mobileSearchResults").html(""),$("#mobileSearchProfiles").html(""),$(".mobile-nav-item").removeClass("active"),$('.mobile-nav-item:has(span:contains("Home"))').addClass("active")}),$(document).on("click",".mobile-nav-item",function(){"Search"===$(this).find("span").text()&&c()}),$(document).on("click",".recent-search-item span",function(e){e.stopPropagation();const t=$(this).text();$("#mobileSearchInput").val(t).trigger("input")}),$(document).on("click",".recent-search-item i",function(e){e.stopPropagation();const t=$(this).siblings("span").text();let a=JSON.parse(localStorage.getItem("recentSearches")||"[]");a=a.filter(e=>e!==t),localStorage.setItem("recentSearches",JSON.stringify(a)),c()}),$(".mobile-search-tab").on("click",function(){const e=$(this).data("tab");$(".mobile-search-tab").removeClass("active"),$(this).addClass("active"),$(".mobile-search-tab-content").removeClass("active"),$("#"+e+"Tab").addClass("active");$("#mobileSearchInput").val().length>0&&$("#mobileSearchInput").trigger("input")}),$("#mobileSearchInput").on("input",function(){const e=$(this).val(),t=$("#mobileSearchResults"),a=$("#mobileSearchProfiles"),o=$(".mobile-search-tab.active").data("tab");if(0===e.length)return t.html(""),void a.html("");"markets"===o?function(e,t){t.html("");[{icon:'<i class="fas fa-landmark"></i>',title:"Fed polymarkets",subtitle:"Trade on Fed-related events.",hasArrow:!0},{icon:'<img src="https://via.placeholder.com/40" alt="Profile">',title:"Fed decision in December?",percentage:"50%",status:"No change"},{icon:'<img src="https://via.placeholder.com/40" alt="Profile">',title:"Fed decision in December?",percentage:"25 bps decrease",status:"success",hasCheck:!0}].forEach(function(e){let a='<div class="mobile-search-result-item">';if(a+='<div class="mobile-search-result-icon">'+e.icon+"</div>",a+='<div class="mobile-search-result-content">',a+='<div class="mobile-search-result-title">'+e.title+"</div>",e.subtitle&&(a+='<div class="mobile-search-result-subtitle">'+e.subtitle+"</div>"),a+="</div>",e.percentage||e.status){if(a+='<div class="mobile-search-result-stats">',e.percentage&&(a+='<div class="mobile-search-result-percentage">'+e.percentage+"</div>"),e.status){a+='<div class="mobile-search-result-status '+("success"===e.status?"success":"")+'">'+(e.hasCheck?'<i class="fas fa-check"></i>':"")+("success"!==e.status?e.status:"")+"</div>"}a+="</div>"}e.hasArrow&&(a+='<i class="fas fa-chevron-right mobile-search-result-arrow"></i>'),a+="</div>",t.append(a)})}(0,t):a.html('<div style="color: var(--text-secondary); padding: 20px; text-align: center;">No profile results found</div>')}),$(document).on("keydown",function(e){"Escape"===e.key&&$("#mobileSearchPopup").hasClass("active")&&($("#mobileSearchPopup, #mobileSearchOverlay").removeClass("active"),$("body").css("overflow",""),$("#mobileSearchInput").val(""))}),$("#themeToggleMobile").on("click",function(){t.hasClass("light-mode")?i("dark"):i("light")});const r=new IntersectionObserver(e=>{e.forEach(e=>{e.isIntersecting&&$(e.target).css("animation","fadeIn 0.5s ease")})});$(".market-card").each(function(){r.observe(this)})}),$(document).ready(function(){$(document).on("click",".content-tab",function(){const e=$(this).data("tab");$(".content-tab").removeClass("active"),$(this).addClass("active"),$(".tab-content-wrapper").addClass("d-none"),$(`#${e}-tab`).removeClass("d-none")}),$(document).on("click",".subtab-btn",function(){const e=$(this).data("subtab");$(".subtab-btn").removeClass("active"),$(this).addClass("active"),"active"===e?($(".active-headers").removeClass("d-none"),$(".closed-headers").addClass("d-none"),$("#sortFilterBtn span").text("Value")):($(".active-headers").addClass("d-none"),$(".closed-headers").removeClass("d-none"),$("#sortFilterBtn span").text("Profit/Loss"))}),$(document).on("click",".time-filter-btn",function(){$(".time-filter-btn").removeClass("active"),$(this).addClass("active");const e=$(this).data("time"),t=$("#profitLossTimeframe");"ALL"===e?t.text("All-Time"):"1D"===e?t.text("Past Day"):"1W"===e?t.text("Past Week"):"1M"===e&&t.text("Past Month")}),$(document).on("click","#sortFilterBtn",function(e){e.stopPropagation();const t=$(this).closest(".filter-dropdown-wrapper");$(".filter-dropdown-wrapper").not(t).removeClass("active"),t.toggleClass("active")}),$(document).on("click","#sortFilterMenu .filter-dropdown-item",function(e){e.preventDefault();$(this).data("sort");const t=$(this).text();$("#sortFilterMenu .filter-dropdown-item").removeClass("active"),$(this).addClass("active"),$("#sortFilterBtn span").text(t),$(this).closest(".filter-dropdown-wrapper").removeClass("active")}),$(document).on("click","#amountFilterBtn",function(e){e.stopPropagation();const t=$(this).closest(".filter-dropdown-wrapper");$(".filter-dropdown-wrapper").not(t).removeClass("active"),t.toggleClass("active")}),$(document).on("click","#amountFilterMenu .filter-dropdown-item",function(e){e.preventDefault();$(this).data("amount");const t=$(this).text();$("#amountFilterMenu .filter-dropdown-item").removeClass("active"),$(this).addClass("active"),$("#amountFilterBtn span").text(t),$(this).closest(".filter-dropdown-wrapper").removeClass("active")}),$(document).on("input",".search-input",function(){const e=$(this).val().toLowerCase().trim();$(".positions-table tbody tr").each(function(){$(this).text().toLowerCase().includes(e)?$(this).show():$(this).hide()})}),$(document).on("click",function(e){$(e.target).closest(".filter-dropdown-wrapper").length||$(".filter-dropdown-wrapper").removeClass("active")})}),$(document).ready(function(){function e(){const e=window.location.hash.replace("#","");e&&["profile","account","trading","notifications","builder","export"].includes(e)&&($(".settings-tab").removeClass("active"),$(".mobile-profile-dropdown-item").removeClass("active"),$(".profile-nav-dropdown-menu .dropdown-item").removeClass("active"),$(`.settings-tab[data-tab="${e}"]`).addClass("active"),$(`.mobile-profile-dropdown-item[data-tab="${e}"]`).addClass("active"),$(`.profile-nav-dropdown-menu .dropdown-item[href*="${e}"]`).addClass("active"),$(".tab-content").removeClass("active"),$(`#${e}-tab`).addClass("active"),setTimeout(()=>{$("html, body").animate({scrollTop:$(".settings-container").offset().top-20},300)},100))}$("#mobileProfileDropdownBtn").on("click",function(e){e.stopPropagation(),$(".mobile-profile-dropdown").toggleClass("active")}),$(document).on("click",function(e){$(e.target).closest(".mobile-profile-dropdown").length||$(".mobile-profile-dropdown").removeClass("active")}),$(".mobile-profile-dropdown-item").on("click",function(e){e.preventDefault();const t=$(this).data("tab");$(".mobile-profile-dropdown-item").removeClass("active"),$(this).addClass("active"),$(".settings-tab").removeClass("active"),$(`.settings-tab[data-tab="${t}"]`).addClass("active"),$(".tab-content").removeClass("active"),$(`#${t}-tab`).addClass("active"),$(".mobile-profile-dropdown").removeClass("active"),$("html, body").animate({scrollTop:$(".settings-container").offset().top-20},300)}),e(),$(window).on("hashchange",e),$(".settings-tab").on("click",function(e){e.preventDefault(),$(".settings-tab").removeClass("active"),$(this).addClass("active"),$(".tab-content").removeClass("active");let t=$(this).data("tab");$(`#${t}-tab`).addClass("active"),$(".mobile-profile-dropdown-item").removeClass("active"),$(`.mobile-profile-dropdown-item[data-tab="${t}"]`).addClass("active")})}),$(document).ready(function(){if(0===$("#marketChart").length&&0===$(".outcome-row").length)return;function e(e,t){const a=[];let o=20*Math.random()+10;for(let i=0;i<t;i++)o=o+10*(Math.random()-.5)+.02*(e-o),a.push(Math.max(0,Math.min(100,o)));return a}$("#tradingPanel").removeClass("active"),$("#mobilePanelOverlay").removeClass("active"),$("body").css("overflow",""),function t(){"undefined"!=typeof Chart?function(){const t=$("#marketChart")[0];t&&"undefined"!=typeof Chart&&(window.marketChart=new Chart(t.getContext("2d"),{type:"line",data:{labels:Array.from({length:100},(e,t)=>t),datasets:[{label:"No change",data:e(50,100),borderColor:"#f97316",borderWidth:2,tension:.1,pointRadius:0},{label:"25 bps decrease",data:e(48,100),borderColor:"#3b82f6",borderWidth:2,tension:.1,pointRadius:0},{label:"50+ bps decrease",data:e(1.9,100),borderColor:"#06b6d4",borderWidth:2,tension:.1,pointRadius:0},{label:"25+ bps increase",data:e(.5,100),borderColor:"#eab308",borderWidth:2,tension:.1,pointRadius:0}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},tooltip:{mode:"index",intersect:!1}},scales:{y:{grid:{color:"#374151"},position:"right",ticks:{callback:e=>e+"%"}}},interaction:{mode:"nearest",axis:"x",intersect:!1}}}))}():setTimeout(t,50)}(),$(".tab-item").click(function(){$(".tab-item").removeClass("active"),$(this).addClass("active"),$(".tab-content").removeClass("active"),$("#"+$(this).data("tab")).addClass("active")}),$(".holders-tab").click(function(){$(".holders-tab").removeClass("active"),$(this).addClass("active"),$("#yes-holders, #no-holders").hide(),$("#"+$(this).data("holders")+"-holders").show()}),$(".activity-filter").click(function(){$(".activity-filter").removeClass("active"),$(this).addClass("active")}),$("#mobileTradeToggle").click(function(){$("#tradingPanel, #mobilePanelOverlay").toggleClass("active")}),$(document).on("click","#mobilePanelOverlay",function(e){e.preventDefault(),$("#tradingPanel").removeClass("active"),$("#mobilePanelOverlay").removeClass("active"),$("#actionTabs").removeClass("buy-only"),$("body").css("overflow","")});let t=0,a=!0,o=!0,i=!1,s=0;function n(){if(void 0!==window.currentYesPrice&&void 0!==window.currentNoPrice){const e=o?window.currentYesPrice:window.currentNoPrice;$("#limitPrice").val(e),s=e}const e=$("#outcomePrice");e.length&&(void 0!==window.currentYesPrice&&void 0!==window.currentNoPrice?a?e.text(o?window.currentYesPrice.toFixed(1)+"¢":window.currentNoPrice.toFixed(1)+"¢"):e.text(o?window.currentNoPrice.toFixed(1)+"¢":window.currentYesPrice.toFixed(1)+"¢"):e.text(a?o?"0.1¢":"99.9¢":o?"99.9¢":"0.1¢"))}function c(e){if("max"===e)return t=1e4,$("#sharesInput").val(t),void l();const a=parseFloat($("#sharesInput").val())||0;t=Math.max(0,a+e),$("#sharesInput").val(t),l()}function r(){l()}function l(){const e=document.getElementById("yesBtn"),t=document.getElementById("noBtn"),a=document.getElementById("sharesInput"),o=document.getElementById("potentialWin");if(!(e&&t&&a&&o))return;let i;if(i=e.classList.contains("active")?parseFloat(e.getAttribute("data-price"))||.5:t.classList.contains("active")?parseFloat(t.getAttribute("data-price"))||.5:parseFloat(e.getAttribute("data-price"))||.5,!i||i<=0||isNaN(i))return void(o.textContent="$0");let s=parseFloat(a.value);if(!s||s<=0||isNaN(s))return void(o.textContent="$0");let n=1*(s/i),c=n-s;n=Math.round(100*n)/100,c=Math.round(100*c)/100,o.textContent="$"+n.toFixed(2)}async function d(e,t,a){$(".outcome-row").removeClass("active selected"),e.addClass("active selected");let o=e.find(".outcome-name").text().trim();o||(o=e.find(".outcome-text .outcome-name").text().trim()),o||(o=e.data("outcome-name")||"");const i=$(".market-title").text().trim()||$("#panelMarketTitle").text().trim(),n=e.find(".btn-yes"),c=e.find(".btn-no"),d=e.data("market-id");let m=e.data("outcomes");if(!m||!Array.isArray(m))try{m=JSON.parse(e.attr("data-outcomes")||'["Yes", "No"]')}catch(e){m=["Yes","No"]}const u=m[0]||"Yes",v=m[1]||"No",p=n.data("outcome")||u,h=c.data("outcome")||v;let f=parseFloat(n.attr("data-price"))||parseFloat(e.attr("data-yes-price"))||.5,b=parseFloat(c.attr("data-price"))||parseFloat(e.attr("data-no-price"))||.5;if(isNaN(f)||f<=0){const e=n.text(),t=c.text(),a=e.match(/([\d.]+)¢/),o=t.match(/([\d.]+)¢/),i=a?parseFloat(a[1]):50,s=o?parseFloat(o[1]):50;f=i/100,b=s/100}if(d)try{const e=await fetch(`/api/market/${d}/live-price`);if(e.ok){const t=await e.json();if(t.success&&void 0!==t.yes_price&&void 0!==t.no_price){let e=parseFloat(t.yes_price),a=parseFloat(t.no_price);e>=1&&e<=100&&(e/=100),a>=1&&a<=100&&(a/=100),e>0&&e<1&&(f=e),a>0&&a<1&&(b=a),console.log("Live prices fetched from Polymarket:",{rawYes:t.yes_price,rawNo:t.no_price,convertedYes:f,convertedNo:b,yesCents:(100*f).toFixed(1)+"¢",noCents:(100*b).toFixed(1)+"¢"})}}}catch(e){console.warn("Failed to fetch live prices, using cached prices:",e)}const w=100*f,g=100*b;i&&$("#panelMarketTitle").text(i),o&&($("#panelOutcomeName").text(o),$("#panelOutcomeTitle").length&&$("#panelOutcomeTitle").text(o)),a&&($("#buyTab").addClass("active"),$("#sellTab").removeClass("active"),$("#actionTabs").addClass("buy-only")),$("#yesBtn").html(`${p} ${w.toFixed(1)}¢`).attr("data-price",f).attr("data-outcome",p).data("price-decimal",f).data("outcome",p),$("#noBtn").html(`${h} ${g.toFixed(1)}¢`).attr("data-price",b).attr("data-outcome",h).data("price-decimal",b).data("outcome",h),window.currentFirstOutcome=p,window.currentSecondOutcome=h,t?($("#yesBtn").addClass("active"),$("#noBtn").removeClass("active"),$("#limitPrice").val(w.toFixed(1)),$("#avgPriceValue").length&&$("#avgPriceValue").text(w.toFixed(0)+"¢")):($("#noBtn").addClass("active"),$("#yesBtn").removeClass("active"),$("#limitPrice").val(g.toFixed(1)),$("#avgPriceValue").length&&$("#avgPriceValue").text(g.toFixed(0)+"¢")),window.currentYesPrice=f,window.currentNoPrice=b,s=t?w:g,setTimeout(function(){"function"==typeof window.calculatePayout&&window.calculatePayout();const e=new CustomEvent("tradingPriceUpdated",{detail:{yesPrice:f,noPrice:b,isYesSelected:t}});document.dispatchEvent(e),"function"==typeof calculate&&calculate(),l()},200),r()}$("#buyTab").click(function(){$(".action-tab").removeClass("active"),$(this).addClass("active"),a=!0,n(),r()}),$("#sellTab").click(function(){$(".action-tab").removeClass("active"),$(this).addClass("active"),a=!1,n(),r()}),$("#orderType").change(function(){i="limit"===$(this).val(),$("#limitOrderFields").toggleClass("active",i),r()}),$("#limitPrice").on("input",function(){s=parseFloat($(this).val())||0,r()}),$("#yesBtn").click(function(){if($(".outcome-btn-yes, .outcome-btn-no").removeClass("active"),$(this).addClass("active"),o=!0,void 0!==window.currentYesPrice&&!isNaN(window.currentYesPrice)){const e=parseFloat(window.currentYesPrice)||0;$("#limitPrice").val(e),$("#avgPriceValue").text(e.toFixed(0)+"¢")}n(),l()}),$("#noBtn").click(function(){if($(".outcome-btn-yes, .outcome-btn-no").removeClass("active"),$(this).addClass("active"),o=!1,void 0!==window.currentNoPrice&&!isNaN(window.currentNoPrice)){const e=parseFloat(window.currentNoPrice)||0;$("#limitPrice").val(e),$("#avgPriceValue").text(e.toFixed(0)+"¢")}n(),l()}),$("#decrease-100").click(()=>c(-100)),$("#decrease-10").click(()=>c(-10)),$("#increase-10").click(()=>c(10)),$("#increase-100").click(()=>c(100)),$("#sharesInput").on("input",function(){const e=$(this).val();t=parseFloat(e)||0,""!==e&&null!=e||(t=0),l()}),$(document).ready(function(){if(""===$("#sharesInput").val()||null===$("#sharesInput").val()||isNaN($("#sharesInput").val())?($("#sharesInput").val(0),t=0):t=parseFloat($("#sharesInput").val())||0,void 0===window.currentYesPrice||isNaN(window.currentYesPrice)){const e=$("#yesBtn");e.length&&e.data("price")?window.currentYesPrice=100*parseFloat(e.data("price"))||0:window.currentYesPrice=0}if(void 0===window.currentNoPrice||isNaN(window.currentNoPrice)){const e=$("#noBtn");e.length&&e.data("price")?window.currentNoPrice=100*parseFloat(e.data("price"))||0:window.currentNoPrice=0}setTimeout(function(){l()},100)}),$(".quick-btn").click(function(){if("maxShares"===this.id)t=Math.floor(1e5);else{const e=parseInt($(this).data("percent"));t=Math.floor(1e3*e/100/.01)}$("#sharesInput").val(t),l()}),$("#executeTrade").click(function(){if(t<=0)return alert("Enter valid shares");if(i&&s<=0)return alert("Enter valid limit price");const e=a?"buy":"sell",n=o?$("#yesBtn").data("outcome")||window.currentFirstOutcome||"Yes":$("#noBtn").data("outcome")||window.currentSecondOutcome||"No",c=$("#panelOutcomeName").text()||$("#panelOutcomeTitle").text()||"",r=i?s/100:a?o?.001:0:o?0:.999,l=t*r,d=a?t*(1-r):t*r;$("#modalBody").html(`\n      <p>You will <strong>${e}</strong> <strong>${t}</strong> shares of <strong>${n}</strong> for <strong>${c}</strong>.</p>\n      <p><strong>Total Cost:</strong> $${l.toFixed(2)}</p>\n      <p><strong>Potential Win:</strong> $${d.toFixed(2)}</p>\n    `),$("#confirmModal").show()}),$("#confirmTrade").click(function(){const e=$("#executeTrade").text();$("#executeTrade").text("Success!").css("background","var(--success)"),setTimeout(()=>{$("#executeTrade").text(e).css("background","var(--accent)")},2e3),t=0,$("#sharesInput").val("0"),$("#limitPrice").val(""),r(),$("#confirmModal").hide();const a="Buy"===$(".action-tab.active").text(),o=$(".outcome-btn.active"),i=o.hasClass("outcome-btn-yes"),s=a?"bought":"sold",n=o.data("outcome")||(i?window.currentFirstOutcome||"Yes":window.currentSecondOutcome||"No"),c=$("#panelOutcomeName").text()||$("#panelOutcomeTitle").text()||"",l=i?.78:.22;$(".activity-list").prepend(`\n      <div class="activity-item">\n        <div class="activity-avatar">Y</div>\n        <div class="activity-details">\n          <div class="activity-action">You ${s} ${t} ${n} for ${c}</div>\n          <div class="activity-meta">Just now</div>\n        </div>\n        <div class="activity-value ${a?"buy":"sell"}">\n          ${(100*l).toFixed(1)}¢ ($${(t*l).toFixed(2)})\n        </div>\n      </div>\n    `)}),$("#cancelTrade, #closeModal").click(()=>$("#confirmModal").hide()),$(window).click(function(e){$(e.target).is("#confirmModal")&&$("#confirmModal").hide()}),n(),r(),$(".chart-btn").click(function(){$(".chart-btn").removeClass("active"),$(this).addClass("active"),window.marketChart&&(window.marketChart.data.datasets[0].data=e(50,100),window.marketChart.data.datasets[1].data=e(48,100),window.marketChart.data.datasets[2].data=e(1.9,100),window.marketChart.data.datasets[3].data=e(.5,100),window.marketChart.update())}),$(".date-tab").click(function(e){e.preventDefault(),$(".date-tab").removeClass("active"),$(this).addClass("active")}),$(".btn-yes").click(async function(e){e.stopPropagation();const t=$(this).closest(".outcome-row"),a=window.innerWidth<=768;if(await d(t,!0,a),a)$("#tradingPanel, #mobilePanelOverlay").addClass("active"),$("body").css("overflow","hidden"),setTimeout(function(){$("#tradingPanel").scrollTop(0)},100);else{const e=$("#tradingPanel");e.length&&$("html, body").animate({scrollTop:e.offset().top-100},500)}}),$(".btn-no").click(async function(e){e.stopPropagation();const t=$(this).closest(".outcome-row"),a=window.innerWidth<=768;if(await d(t,!1,a),a)$("#tradingPanel, #mobilePanelOverlay").addClass("active"),$("body").css("overflow","hidden"),setTimeout(function(){$("#tradingPanel").scrollTop(0)},100);else{const e=$("#tradingPanel");e.length&&$("html, body").animate({scrollTop:e.offset().top-100},500)}}),$(".outcome-row").click(async function(e){if($(e.target).closest(".btn-yes, .btn-no").length)return;const t=$(this),a=window.innerWidth<=768;if(await d(t,!0,a),a)$("#tradingPanel, #mobilePanelOverlay").addClass("active"),$("body").css("overflow","hidden");else{const e=$("#tradingPanel");e.length&&$("html, body").animate({scrollTop:e.offset().top-100},500)}}),$(".show-more-btn").click(function(){$(this).toggleClass("expanded")}),$(document).on("click",".reply-btn",function(){const e=$(this).closest(".comment-section").find(".comment-reply-wrapper");e.slideToggle(200),e.is(":visible")&&e.find(".comment-reply-input").focus()}),$(document).on("click",".comment-reply-cancel-btn",function(){const e=$(this).closest(".comment-reply-wrapper");e.slideUp(200),e.find(".comment-reply-input").val("")}),$(document).on("click",".comment-reply-submit-btn",function(){const e=$(this).siblings(".comment-reply-input"),t=e.val().trim();""!==t?(alert("Reply posted: "+t),e.val(""),$(this).closest(".comment-reply-wrapper").slideUp(200)):alert("Please enter a reply")}),$(document).on("keypress",".comment-reply-input",function(e){13===e.which&&$(this).siblings(".comment-reply-submit-btn").click()}),$(document).on("click",".shares-price",function(){c(parseInt($(this).data("price")))})}),$(function(){const e=$("#headerMenuTrigger"),t=$("#headerMenuDropdown");function a(){t.removeClass("active")}e.length&&t.length&&(e.on("click",function(e){e.preventDefault(),e.stopPropagation(),t.toggleClass("active")}),$(document).on("click",function(){a()}),t.on("click",function(e){e.stopPropagation()}),$(document).on("keydown",function(e){"Escape"===e.key&&a()}))}),$(function(){const e=[];function t(e,t){const a=$(".profile-avatar-wrapper .img-responsive"),o=$(".profile-avatar-wrapper");a.length&&(o.addClass("loading"),a.off("load error"),a.on("load",function(){o.removeClass("loading")}),a.one("error",function(){$(this).attr("src",t),o.removeClass("loading")}),a.attr("src",e))}$(".profile-avatar-wrapper .img-responsive").each(function(){$(this).one("error",function(){$(this).attr("src","./assets/images/user.webp")})});const a=$(".profile-avatar-wrapper");a.css("cursor","pointer");let o=0;a.on("click",function(){o=(o+1)%e.length,t(e[o],"./assets/images/user.webp")});const i=$('<input type="file" accept="image/*" style="display:none;">');$("body").append(i),a.on("click",()=>i.click()),i.on("change",function(e){const a=e.target.files[0];if(!a)return;const o=new FileReader;o.onload=function(e){const a=e.target.result;t(a,"./assets/images/user.webp"),localStorage.setItem("profileImage",a)},o.readAsDataURL(a)});const s=localStorage.getItem("profileImage");s&&t(s,"./assets/images/user.webp")});